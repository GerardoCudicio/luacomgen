
OLE_LIB="c:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\lib\ole32.lib"
OLEAUT_LIB="c:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\lib\oleaut32.lib"
LUA="c:\Lua51\lua.exe"
LUA_INCLUDE_DIR="c:\Lua51\Include"
LUA_LIB="c:\Lua51\lib\lua51.lib"

comgen.obj: comgen.cpp
	cl /c /I$(LUA_INCLUDE_DIR) comgen.cpp

comgen.dll: comgen.obj
	link /dll comgen.obj $(LUA_LIB) $(OLE_LIB) /def:comgen.def

rectpointlib.cpp:
	$(LUA) -l luarocks.require test_generate.lua

rectpointlib.obj: rectpointlib.cpp
	cl /c /I$(LUA_INCLUDE_DIR) /Irectpoint rectpointlib.cpp

rectpointlib.dll: rectpointlib.obj
	link /dll rectpointlib.obj $(LUA_LIB) $(OLE_LIB) $(OLEAUT_LIB) /def:rectpointlib.def

opclib.cpp:
	$(LUA) -l luarocks.require test_genopc.lua

opclib.obj: opclib.cpp
	cl /c /I$(LUA_INCLUDE_DIR) /Iopc opclib.cpp

opclib.dll: opclib.obj
	link /dll opclib.obj $(LUA_LIB) $(OLE_LIB) $(OLEAUT_LIB) /def:opclib.def

all: comgen.dll rectpointlib.dll opclib.dll

clean:
	del *.dll *.obj *.lib *.exp rectpointlib.* opclib.*
